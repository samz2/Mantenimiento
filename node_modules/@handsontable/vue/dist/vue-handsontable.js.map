{"version":3,"file":"vue-handsontable.js","sources":["../../src/common/helpers.ts","../../src/common/HotTable.vue"],"sourcesContent":["import Handsontable from 'hot-alias';\nimport {HotTableProps, VueProps} from './types';\n\n/**\n * Rewrite the settings object passed to the watchers to be a clean array/object prepared to use within Handsontable config.\n *\n * @param {*} observerSettings Watcher object containing the changed data.\n * @returns {Object|Array}\n */\nexport function rewriteSettings(observerSettings): any[] | object {\n  const settingsType = Object.prototype.toString.call(observerSettings);\n  let settings: any[] | object | null = null;\n  let type: { array?: boolean, object?: boolean } = {};\n\n  if (settingsType === '[object Array]') {\n    settings = [];\n    type.array = true;\n\n  } else if (settingsType === '[object Object]') {\n    settings = {};\n    type.object = true;\n  }\n\n  if (type.array || type.object) {\n    for (const p in observerSettings) {\n      if (observerSettings.hasOwnProperty(p)) {\n        settings[p] = observerSettings[p];\n      }\n    }\n\n  } else {\n    settings = observerSettings;\n  }\n\n  return settings;\n}\n\n/**\n * Initialize Handsontable.\n */\nexport function hotInit(): void {\n  const unmappedSettings: any[] = [\n    this.settings ? this.settings : this._props,\n  ];\n\n  if (this.settings) {\n    unmappedSettings.push(this._props)\n  }\n\n  this.hotInstance = new Handsontable(this.$el, prepareSettings(unmappedSettings[0], unmappedSettings[1]));\n\n  preventInternalEditWatch(this);\n}\n\n/**\n * Private method to ensure the table is not calling `updateSettings` after editing cells.\n * @private\n */\nfunction preventInternalEditWatch(component) {\n  component.hotInstance.addHook('beforeChange', () => {\n    component.__internalEdit = true;\n  });\n\n  component.hotInstance.addHook('beforeCreateRow', () => {\n    component.__internalEdit = true;\n  });\n\n  component.hotInstance.addHook('beforeCreateCol', () => {\n    component.__internalEdit = true;\n  });\n\n  component.hotInstance.addHook('beforeRemoveRow', () => {\n    component.__internalEdit = true;\n  });\n\n  component.hotInstance.addHook('beforeRemoveCol', () => {\n    component.__internalEdit = true;\n  });\n}\n\n/**\n * Generate an object containing all the available Handsontable properties and plugin hooks.\n *\n * @returns {Object}\n */\nexport function propFactory(): VueProps<HotTableProps> {\n  const registeredHooks: string[] = Handsontable.hooks.getRegistered();\n\n  //TODO: workaround for `DefaultSettings` being an interface and not a class in `handsontable.ts`\n  const hotTemp: any = Handsontable;\n  const propSchema: VueProps<HotTableProps> = new hotTemp.DefaultSettings();\n\n  for (let prop in propSchema) {\n    propSchema[prop] = {};\n  }\n\n  for (let i = 0; i < registeredHooks.length; i++) {\n    propSchema[registeredHooks[i]] = {\n      type: Function\n    };\n  }\n\n  propSchema.id = {\n    type: String,\n    default: 'hot-' + Math.random().toString(36).substring(5)\n  };\n\n  propSchema.settings = {\n    type: Object as () => Handsontable.DefaultSettings\n  };\n\n  return propSchema;\n}\n\n/**\n * Generate and object containing all the available Handsontable properties and hooks tied to the Handsontable updating function.\n *\n * @param {Function} updateFunction Function used to update a single changed property.\n * @returns {Object}\n */\nexport function propWatchFactory(updateFunction: Function) {\n  const props: object = propFactory();\n  const watchList = {};\n\n  for (const prop in props) {\n    if (props.hasOwnProperty(prop)) {\n      if (prop !== 'settings') {\n        watchList[prop] = {\n          handler: function (...args) {\n            return updateFunction.call(this, prop, ...args);\n          },\n          deep: true\n        };\n\n        watchList[`settings.${prop}`] = {\n          handler: function (...args) {\n            return updateFunction.call(this, prop, ...args);\n          },\n          deep: true\n        };\n      }\n    }\n  }\n\n  return watchList;\n}\n\n// The `this` value in the functions below points to the Vue component instance. They're not meant to used anywhere but in the context of the component.\n\n/**\n * Update the Handsontable instance with a single changed property.\n *\n * @param {String} updatedProperty Updated property name.\n * @param {Object} updatedValue Watcher-generated updated value object.\n * @param {Object} oldValue Watcher-generated old value object.\n */\nexport function updateHotSettings(updatedProperty: string, updatedValue: object, oldValue: object) {\n  const newSettings = {};\n\n  if (updatedProperty === 'data' && this.__internalEdit === true) {\n    this.__internalEdit = false;\n    return;\n  }\n\n  newSettings[updatedProperty] = rewriteSettings(updatedValue);\n  this.hotInstance.updateSettings(newSettings);\n}\n\n/**\n * Prepare the settings object containing the `on`-properties to be used in the Handsontable configuration.\n *\n * @param {Object} settings An object containing the properties, including the `on`-prefixed hook names.\n * @param {Object} [additionalSettings] An additional object containing the properties, including the `on`-prefixed hook names.\n * @returns {Object} An object containing the properties, with the `on`-prefixes trimmed.\n */\nexport function prepareSettings(settings: object, additionalSettings?: object): Handsontable.DefaultSettings {\n  const newSettings = {};\n\n  for (const key in settings) {\n    if (settings.hasOwnProperty(key) && settings[key] !== void 0) {\n      newSettings[key] = settings[key];\n    }\n  }\n\n  for (const key in additionalSettings) {\n    if (additionalSettings.hasOwnProperty(key) && additionalSettings[key] !== void 0) {\n      newSettings[key] = additionalSettings[key];\n    }\n  }\n\n  return newSettings;\n}\n","<template>\n  <div :id=\"id\"></div>\n</template>\n\n<script lang=\"ts\">\n  import {\n    propFactory,\n    propWatchFactory,\n    updateHotSettings,\n    hotInit\n  } from './helpers';\n  import Vue from 'vue';\n  import {HotTableData, HotTableMethods, HotTableProps, HotTableComponent} from './types';\n  import * as packageJson from './../../package.json';\n\n  const HotTable: HotTableComponent<Vue, HotTableData, HotTableMethods, {}, HotTableProps> = {\n    name: 'HotTable',\n    props: propFactory(),\n    watch: propWatchFactory(updateHotSettings),\n    data: function () {\n      return {\n        __internalEdit: false,\n        hotInstance: null\n      }\n    },\n    methods: {\n      hotInit: hotInit\n    },\n    mounted: function () {\n      return this.hotInit();\n    },\n    beforeDestroy: function () {\n      this.hotInstance.destroy();\n    },\n    version: (packageJson as any).version\n  };\n\n  export default HotTable;\n  export {HotTable};\n</script>\n"],"names":["rewriteSettings","observerSettings","settingsType","Object","prototype","toString","call","settings","type","array","object","p","hasOwnProperty","hotInit","unmappedSettings","_props","push","hotInstance","Handsontable","$el","prepareSettings","preventInternalEditWatch","component","addHook","__internalEdit","propFactory","registeredHooks","hooks","getRegistered","hotTemp","propSchema","DefaultSettings","prop","i","length","Function","id","String","Math","random","substring","propWatchFactory","updateFunction","props","watchList","args","updateHotSettings","updatedProperty","updatedValue","oldValue","newSettings","updateSettings","additionalSettings","key"],"mappings":"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"}